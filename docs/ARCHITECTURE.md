# μ±—λ΄‡ μ•„ν‚¤ν…μ² κ°€μ΄λ“

## π“ μ „μ²΄ κµ¬μ΅°

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚            UI Layer (React Native)              β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚         chatbot.tsx (Screen)            β”‚   β”‚
β”‚  β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β” β”‚   β”‚
β”‚  β”‚  β”‚ Message  β”‚  β”‚  Input   β”‚  β”‚ Quick β”‚ β”‚   β”‚
β”‚  β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β” β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                      β†•
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚         State Management Layer                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚
β”‚  β”‚ Client State     β”‚  β”‚ Server State     β”‚    β”‚
β”‚  β”‚ (Jotai)          β”‚  β”‚ (React Query)    β”‚    β”‚
β”‚  β”‚                  β”‚  β”‚                  β”‚    β”‚
β”‚  β”‚ - messages       β”‚  β”‚ - mutation       β”‚    β”‚
β”‚  β”‚ - addMessage     β”‚  β”‚ - isPending      β”‚    β”‚
β”‚  β”‚ - initChat       β”‚  β”‚ - error          β”‚    β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                      β†•
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚           API Layer                             β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚       chat-service.ts                   β”‚   β”‚
β”‚  β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β”‚   β”‚
β”‚  β”‚  β”‚ Claude   β”‚        β”‚  OpenAI  β”‚      β”‚   β”‚
β”‚  β”‚  β”‚   API    β”‚        β”‚   API    β”‚      β”‚   β”‚
β”‚  β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π”„ μƒνƒ κ΄€λ¦¬ μ „λµ

### ν΄λΌμ΄μ–ΈνΈ μƒνƒ (Jotai)
**μ„μΉ**: `store/chat-store.ts`

**λ‹΄λ‹Ή**:
- λ©”μ‹μ§€ λ©λ΅ (`messagesAtom`)
- λ©”μ‹μ§€ μ¶”κ°€/μ‚­μ  μ•΅μ…
- UI μƒνƒ
- λ΅μ»¬ λ°μ΄ν„°

**μ¥μ **:
- λΉ λ¥Έ μƒνƒ μ—…λ°μ΄νΈ
- μμΈ΅ κ°€λ¥ν• UI λ³€ν™”
- μ¤ν”„λΌμΈ λ™μ‘ κ°€λ¥

### μ„λ²„ μƒνƒ (React Query)
**μ„μΉ**: `hooks/use-chat-mutation.ts`

**λ‹΄λ‹Ή**:
- API νΈμ¶ κ΄€λ¦¬
- λ΅λ”© μƒνƒ (`isPending`)
- μ—λ¬ ν•Έλ“¤λ§ (`error`)
- μ¬μ‹λ„ λ΅μ§
- μΊμ‹±

**μ¥μ **:
- μλ™ μ¬μ‹λ„
- μ—λ¬ κ²½κ³„ μ²λ¦¬
- μ¤‘λ³µ μ”μ²­ λ°©μ§€
- μΊμ‹ κ΄€λ¦¬

## π“ λ°μ΄ν„° ν”λ΅μ°

### λ©”μ‹μ§€ μ „μ†΅ ν”λ΅μ°
```
1. sendMessage("κ±΄λ€μ…κµ¬μ—­ μ£Όμ°¨μ¥")
2. addMessage({ role: 'user', ... })  // ν΄λΌμ΄μ–ΈνΈ μƒνƒ (μ¦‰μ‹)
3. sendMessageMutation(...)           // API νΈμ¶ (λΉ„λ™κΈ°)
4. isPending = true                   // λ΅λ”© μ‹μ‘
5. API μ‘λ‹µ λ€κΈ°...
6. addMessage({ role: 'assistant', ... })  // ν΄λΌμ΄μ–ΈνΈ μƒνƒ
7. isPending = false                  // λ΅λ”© μΆ…λ£
```

## π― Hook μ‚¬μ©λ²•

```typescript
const { 
  messages,     // λ©”μ‹μ§€ λ©λ΅ (Jotai)
  isLoading,    // λ΅λ”© μƒνƒ (React Query)
  error,        // μ—λ¬ (React Query)
  sendMessage,  // λ©”μ‹μ§€ μ „μ†΅
  initChat      // μ΄κΈ°ν™”
} = useChat('claude');
```
